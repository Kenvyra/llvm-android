From 3702b8873c35ff950e6cfa7952d75cd92abb3c8e Mon Sep 17 00:00:00 2001
From: Jens Reidel <jens.reidel@gmail.com>
Date: Tue, 2 Aug 2022 15:23:25 +0200
Subject: [PATCH] SONAME is the same as major in LLVM 16

Change-Id: Ie84aeb9783eb6e4ad86cd7c43b32ea78433a106f
---
 do_build.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/do_build.py b/do_build.py
index f303071..8624a8f 100755
--- a/do_build.py
+++ b/do_build.py
@@ -259,13 +259,13 @@ def normalize_llvm_host_libs(install_dir: Path, host: hosts.Host, version: Versi
 
         short_version, major = getVersions(libname)
 
-        soname_version = '13' if libname == 'libclang' else major
+        soname_version = major
         soname_lib = os.path.join(libprefix, libformat.format(version=soname_version))
         if libname.startswith('libclang') and libname != 'libclang-cpp':
             soname_lib = soname_lib[:-3]
         real_lib = os.path.join(libprefix, libformat.format(version=short_version))
 
-        preserved_libnames = ('libLLVM', 'libclang-cpp')
+        preserved_libnames = ('libLLVM', 'libclang-cpp', 'libclang')
         if libname not in preserved_libnames and os.path.exists(real_lib):
             # Rename the library to match its SONAME
             if not os.path.isfile(real_lib):
-- 
2.37.3

